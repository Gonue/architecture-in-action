# Ch02

## 개략적인 규모 추정

개략적인 규모 측정은 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위로서, 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것.

개략적 규모 추정을 효과적으로 해 내 려면 규모 확장성을 표현하는데 필요한 기본기에 능숙해야 하며, 특히, 2의 제곱수나 응답지연 값, 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 한다.

### 2의 제곱수

분산 시스템에서 다루는 데이터 양은 엄청나게 커질 수 있으나 그 계산법은 기본에서 크게 벗어나지 않는다.
제대로 된 계산 결과를 얻으려면 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 우선적으로 알아야 한다.

- 최소 단위는 1바이트 이고 8비트로 구성
- 아스키 문자 하나가 차지하는 메모리 크기는 1바이트 이며 보통 많이 사용되는 UTF-8 의 경우 1~4바이트 사용
- 한글 또는 다국어를 고려할 때 한다어를 4바이트 까지 고려하는게 좋음
  
아래는 흔히 쓰이는 데이터 볼륨 단위.

|2의 x 제곱|근사치|이름|축약형| 
|---|---|---|---|
|10|1천(thousand)|1킬로바이트(Kilobyte)|1KB|
|20|1백만(million)|1메가바이트(Megabyte)|1MB|
|30|10억(billion)|1기가바이트(Gigabyte)|1GB|
|40|1조(trilion)|1테라바이트|1TB|
|50|1000조(quadrillion)|1페타바이트(Petabyte)|1PB|


### 응답지연 값

구글의 제프딘이 2010년에 통상적인 컴퓨터에서 구현된 연산들의 응답지연 값을 공해.

아래 표 가운데 몇몇은 더 빠른 컴퓨터가 등장하면서 더 이상 유효하지 않게 되었지만, 아직도 이 수치들은 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있도록 도와준다.

![image](https://github.com/Gonue/architecture-in-action/assets/109960034/a03b8f99-0563-40a9-b302-5b1612417d31)

위의 표를 참조하여 Colin Scoot이란 사람이 시각화하여 보여주는 사이트를 제작

아래 사이트에서 연도별로 수치 확인 가능.

> https://colin-scott.github.io/personal_website/research/interactive_latency.html

확인 할 수 있는 가장 최근 년도는 2020년도까지 수치화 되어 있다.

[![image](https://github.com/Gonue/architecture-in-action/assets/109960034/a03b8f99-0563-40a9-b302-5b1612417d31)
](https://colin-scott.github.io/personal_website/research/interactive_latency.html)

결론은

- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여려 지역(region)에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

### 가용성에 관계된 수치들

고가용성(high availabiltiy)은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어 이며, 고가용성을 표현하는 값은 퍼센트로 표현하는데, 100%는 시스템이 단 한번도 중단된 적이 없었음을 의미.

대부분의 서비스는 99%에서 100% 사이의 값을 갖는다.

SLA은 서비스 사업자가 보편적으로 사용하는 용어로, 서비스 사업자와 고객 사이에 맺어진 합의를 의미.

이 합의에는 서비스 사업자가 제공하는 서비스의 가용시간이 공식적으로 기술되어 있으며, 아마존, 구글, MS Soft 같은 사업자는 99% 이상의 SLA를 제공.

가용시간은 관습적으로 숫자 9를 사용해 표시하며, 9가 많으면 많을수록 가용성이 높다.

아래표는 9의 개수와 시스템 장애 시간 사이의 관계

|가용률|하루당 장애시간|주당 장애시간|개월당 장애시간| 연간 장애시간|
|---|---|---|---|---|
|99%|14.40분|1.68시간|7.31시간|3.65일
|99.9%|1.44분|10.08분|43.83분|8.77시간|
|99.99%|8.64초|1.01분|4.38분|52.60분|
|99.999%|864.00밀리초|6.05초|26.30초|5.26분|
|99.9999%|86.40밀리초|604.80밀리초|2.63초|31.56초|

### 예제: 트위터 QPS와 저장소 요구량 추정

#### 가정
- 월간 능동 사용자(monthly active user)는 3억(300milion) 명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년간 보관된다.

#### 추정

QPS(Query Per Second) 추정치

- 일간 능동 사용자(Daily Active User, DAU) = 3억 x 50% = 1.5억(150milion)

- QPS = 1.5억 X 2 트윗 / 24시간 /3600초 = 약 3500

- 최대 QPS(Peek QPS) = 2 x QPS = 약 7000

#### 미디어 저장을 위한 저장소 요구량

- 평균 트윗 크기
  - tweet_id에 64바이트
  - 텍스트에 140바이트
  - 미디어에 1MB
- 미디어 저장소 요구량 : 1.5억 x 2 x 10% x 1MB = 30TB /일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB X 365 X 5 = 약 55PB